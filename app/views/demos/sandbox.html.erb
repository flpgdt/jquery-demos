<h1>Sandbox</h1>

<form id="sandbox">
  <p>
    <label for="code">Code:</label><br/>
    <textarea rows="5" cols="73" name="code" id="code">
    </textarea>
  </p>
  <p>
  <p>
    <input type="submit" value="Formatted!" id="formatted"/>
    <input type="submit" value="Unformatted!" id="unformatted"/>
  </p>
</form>

<pre style="font-size:300%;"><code class="js-shell">
<span class="input" id="input">&nbsp;</span>
<span class="output"id="output">&nbsp;</span>
</code></pre>

<script type="text/javascript">
function formatObject(result) {
    var formatted = "";
    $.each(result, function(name, val) {
        formatted = formatted + name + ": " + val + "\n   ";
    })
    return formatted;
}

function formatArray(result) {
    return "[" + result + "]";
}

function formatResult(result) {
    if ($.isArray(result)) {
        return formatArray(result);
    }
    if (typeof(result) == "object") {
        return formatObject(result);
    } 
    return result;   
}

function errorHandler(fn) {
    return function() {
        try {
            fn();
        } catch (err) {
            $("#output").text("=> " + err.message);
        }
    }
}

function evalCode() {
    return eval("(" + $("#code").val() + ")");
}

$(function() {
    $("#code").val("");
    $("#sandbox").submit(function() {
        return false;
    });
    $("#formatted").click(errorHandler(function() {
        $("#input").text($("#code").val());
        $("#output").text("=> " + formatResult(evalCode()));
    }));
    $("#unformatted").click(errorHandler(function() {
        $("#input").text($("#code").val());
        $("#output").text("=> " + evalCode());
    }));
});
</script>